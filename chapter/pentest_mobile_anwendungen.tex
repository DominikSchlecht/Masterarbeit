\chapter{Penetration-Tests mobiler Anwendungen}
Durch die zunehmende Nachfrage des Marktes nach mobilen Anwendungen entwickelt die Allianz Deutschland AG zunehmend mobile Applikationen. Dafür müssen nicht nur die bestehenden Prozesse angepasst, sondern auch neue Werkzeuge zur Unterstützung der Security-Prozesse geschaffen werden.\\

Im Folgenden sind die Anforderungen an ein solches Werkzeug festgehalten, gefolgt mit einer Evaluierung bestehender Programme. Daraufhin wurde ein passendes Werkzeug ausgewählt und weiterentwickelt. Diese Weiterentwicklung ist unter Abschnitt \ref{Weiterentwicklung MobSF} beschrieben. Abschließend werden die erreichten Anforderungen mit den ursprünglichen verglichen.

\section{Anforderungen}\label{ref:PenMobAnwdWeiterAnford}
Im Folgenden sind die Anforderungen festgehalten, welche für einen Echt-Einsatz in der Allianz Deutschland AG notwendig sind.

\begin{description}
	\item[Einfache Einrichtung] Das Tool sollte möglichst unkompliziert einem Benutzer zur Verfügung gestellt werden können. Dies könnte entweder über eine einfache Installation oder durch die Ausführung auf einer zentralen, erreichbaren Instanz realisiert werden.
	
	\item[Einfache Handhabung] Im Optimalfall soll ein Scan bereits nach einer kurzen Einführungszeit durch einen im Bereich Informationssicherheit zuvor ungeschulten oder nur rudimentär geschulten Mitarbeiter durchgeführt werden können. Dazu muss das Tool einfach zu bedienen sein.
	
	\item[Verständliche Ergebnisse] Es sollte eine Übersicht geben, die auch einen Mitarbeiter ohne Erfahrungen im Bereich Informationssicherheit eine erste Einschätzung ermöglicht. Die genauen Ergebnisse des Werkzeugs sollten für einen in der Informationssicherheit arbeitenden Angestellten verständlich sein. Hier kann eine gewisse Fachkenntnis vorausgesetzt werden. Grundlagen (wie zum Beispiel warum \textit{memcpy} auf eine mögliche Schwachstelle hinweist) müssen durch das Werkzeug nicht vermittelt werden.
	
	\item[Unterstützung für \textit{Android}/\textit{iOS}/\textit{Windows Phone}] Um zu verhindern, dass für jede der aktuell geläufigen Plattformen ein eigenes Werkzeug genutzt werden muss, sollte das Werkzeug die Analyse von Apps für \textit{Android}, \textit{iOS} und \textit{Windows Phone} unterstützen.
	
	\item[Niedrige False-Positive-Rate] Das Werkzeug sollte eine möglichst geringe Rate an \textit{False-Positives}, also falschen Meldungen, aufweisen. Jedoch sollten auch keine Hinweise auf Schwachstellen verworfen werden, sodass das Werkzeug eine Einstufung der Ergebnisse vornehmen sollte.
	
	\item[Reproduzierbarkeit] Das Werkzeug sollte reproduzierbare Ergebnisse liefern, also bei gleichem Eingangswert das gleiche Ergebnis generieren. Dies ist für die Nachverfolgung von Meldungen äußerst wichtig.
	
\end{description}

\input{chapter/pentest_mobile_anwendungen/bestehende_anwendungen}

\input{chapter/pentest_mobile_anwendungen/vergleich_aktuelle_situation}

\newpage
\section{Abgleich der Anforderungen mit MobSF}\label{ref:PenMobAnwAbgAndMobSF}

Im folgenden Abschnitt werden die Anforderungen aus \ref{ref:PenMobAnwdWeiterAnford} mit den bestehenden Eigenschaften von \textit{MobSF} abgeglichen.

\begin{description}
	\item[Einfache Einrichtung] \textit{MobSF} benötigt keine echte Installation, sondern kann einfach aus dem Github-Repository heruntergeladen werden. Die anschließenden Konfigurationsschritte unterscheiden sich leicht nach Betriebssystem, bestehen jedoch grundsätzlich immer aus der Installation von Python sowie der Installation der Abhängigkeiten über das Python-Tool \textit{pip}. Abschließend sollten die Einstellungen an die Umgebung angepasst werden. Damit ist die Installation nicht trivial, aber gut dokumentiert und durch eine Person mit Fachkenntnis in kurzer Zeit durchzuführen.
	
	\item[Einfache Handhabung] Die Handhabung von \textit{MobSF} wird über eine HTML-Oberfläche abgebildet. Samples können per Drag-n-Drop zur Analyse eingereicht werden. Die Realisierung als Web-Anwendung hat den Vorteil, dass das Tool zentral installiert und von verschiedenen Orten über das Netzwerk genutzt werden kann.
	
	\item[Verständliche Ergebnisse] Die Ergebnisse einer Analyse werden ebenfalls in der HTML-Anwendung dargestellt. Dabei ist über Farb-Codes einfach zu erkennen, ob Probleme mit der App bestehen. Eine genaue Analyse der Ergebnisse und weiterführende Untersuchungen sollten jedoch durch Experten durchgeführt werden.
	
	\item[Unterstützung für Android/iOS/Windows Phone] Vor der Weiterentwicklung von \textit{MobSF} unterstützte das Framework die statische und dynamische Analyse von \textit{Android}-Apps sowie die statische Analyse von \textit{iOS}-Apps. Eine Analyse von \textit{Windows-Phone}-Apps ist noch nicht enthalten.
	
	\item[Niedrige False-Positive-Rate] \textit{MobSF} beschreibt nicht direkt Schwachstellen, sondern Indikatoren wie beispielsweise die Verwendung von verwundbaren Funktionen. Daher sind die gegebenen Warnungen stets korrekt, jedoch wird womöglich auch in manchen Bereichen nicht alles entdeckt.
	
	\item[Reproduzierbarkeit] \textit{MobSF} benutzt zumeist Tools, welche in \textit{MobSF} selbst enthalten sind. Daher sollte dieselbe Version von \textit{MobSF} auch auf verschiedenen Rechnern gleiche Ergebnisse liefern.
	
\end{description}

Somit sind alle Anforderungen bis auf die Unterstützung von Windows-Phone-Apps ausreichend erfüllt.

\pagebreak	
\section{Laboraufbau}
Zur Weiterentwicklung des \textit{MobSF} wurde unterschiedliche Hardware mit verschiedenen Werkzeugen genutzt.\\

Als Hardware wurde durch die Allianz Deutschland AG ein Apple Mac-Book Pro mit ausreichenden Ressourcen gestellt (i7, 16GB RAM). Als Betriebssystem wurde anfangs \textit{Mac OS X Maverick} und später \textit{Sierra} verwendet.\\

Um die Entwicklung für Windows-spezifische Anwendungen zu realisieren, wurde eine virtuelle Maschine mit \textit{Windows  10} über \textit{VMWare Fusion}\footnote{\url{https://www.vmware.com/de/products/fusion.html}} verwendet.\\

Als Software wurde Python\footnote{\url{https://www.python.org/}} in Version 2.7 und 3.6 sowie die jeweiligen Abhängigkeiten in Form von Modulen genutzt.\\

Als Entwicklungsumgebung wurde \textit{Atom}\footnote{\url{https://atom.io/}} mit \textit{Pylint}\footnote{\url{https://www.pylint.org/}} für Python 2.7/3.6 und \textit{VIM}\footnote{\url{http://www.vim.org/}} genutzt.

%\section{Entwicklung der Umgebung}
%	\subsection{Aufbau}
	

%	\subsection{Schnittstellen}

\input{chapter/pentest_mobile_anwendungen/weiterentw_mobsf}		

  
\section{Abgleich mit Anforderungen}
Durch die Weiterentwicklung des \textit{MobSF} wurde vor allem der Punkt "`Unterstützung von \textit{Android}/\textit{iOS}/\textit{Windows Phone}"' verbessert. So ist nun eine statische Analyse von \textit{Windows-Phone}-Apps über die Tools des \textit{Windows SDL} möglich. Zudem wurde die Grundlage für eine dynamische Analyse von \textit{iOS}-Apps geschaffen. Auch wurde die statische Analyse von \textit{iOS}-Apps erweitert, was bessere Ergebnisse zur Folge hat.\\

Somit sind alle Anforderungen aus \ref{ref:PenMobAnwdWeiterAnford} ausreichend erfüllt.


\section{Anwendung der Umgebung}
	Im Folgenden wird die weiterentwickelte Version des \textit{MobSF} auf zwei selbstgeschriebene Applikationen angewendet. Dabei handelt es sich bei Anwendung 1 um eine \textit{Windows-Phone}-App und bei Applikation 2 um eine \textit{iOS}-App.

	\subsection{Test Anwendung 1 - Windows-Phone}
	Um die eingebauten Features bezüglich der statischen Analyse von Windows-Phone-Apps zu testen, wurde eine minimalistische App geschrieben.\\
	
	Diese enthält ein Code-Segment mit der \textit{strcpy}-Funktion, welches unter \ref{lst:PenMobAnwWinStrcpy} dargestellt ist. Ebenso wurde die Option \textit{CFG} (\textit{Control Flow Guard}) für den Test deaktiviert. Der vollständige Quellcode ist dem Datenträger unter 
\begin{lstlisting}
/Apps/iOS/vuln_app_wp.zip
\end{lstlisting} angehängt. Die Inhalte des Datenträgers sind ebenfalls dem zu dieser Arbeit zugehörigen Repository in Github veröffentlicht\footnote{\url{https://github.com/DominikSchlecht/Pen-Test_bei_mob_Anwendungen}}.\\
	
\begin{figure}
\begin{lstlisting}
char to[10];
char from[] = "AAAAAAAAAAA";
strcpy(to, from);
\end{lstlisting}
\caption{Buffer-Overflow über strcpy in der Windows-Phone-Test-App}
\label{lst:PenMobAnwWinStrcpy}
\end{figure}
	
	Die App wurde anschließend durch \textit{MobSF} analysiert. Dabei wurden mehrere unsichere Funktionen, unter anderem die absichtlich eingebaute \textit{strcpy}-Funktion gefunden. Ebenso wurde detektiert, dass \textit{CFG} nicht aktiviert ist. Der vollständige Bericht, inklusive der String-Analyse, ist auf dem Datenträger unter \begin{lstlisting}
/Apps/iOS/vuln_app_wp_report.pdf
\end{lstlisting} abgelegt.
	
	\subsection{Test Anwendung 2 - iOS}
	Zur Entwicklung der Test-Applikation wurde \textit{Xcode 8} verwendet. Die App hat eine definierte Ausnahme in der \textit{ATS} und benötigt die \textit{NSAppleMusicUsageDescription}-Berechtigung. Ebenso benutzt sie, ähnlich zur \textit{Windows-Phone}-App, \textit{strcpy} zum Kopieren eines \textit{char}-Arrays. Die vollständigen Source-Dateien sind auf dem beigelegten Datenträger unter 
\begin{lstlisting}
/Apps/iOS/vuln_app_ios.zip
\end{lstlisting}
zu finden.\\
	
	Auch hier findet \textit{MobSF} die eingebauten Anomalien. So werden die Ausnahme der \textit{ATS}, sowie die \textit{strcpy}-Funktion gefunden und als unsicher dargestellt. Auch die \textit{NSAppleMusicUsageDescription}-Berechtigung wurde detektiert und mit der Begründung dargestellt. Unter Grafik \ref{fig:PenMobAnwiOSErgebnis} sind die Ergebnisse im Überblick dargestellt; der vollständige Bericht ist auf dem Datenträger unter 
\begin{lstlisting}
/Apps/iOS/vuln_app_ios_report.pdf
\end{lstlisting} abgelegt.
	
\begin{figure}[htbp]
	\centering
	\includegraphics[width=\textwidth]{bilder/pentest_mobile_anwendungen/ergebnis_ios.png}
	\caption{Ergebnis des MobSF für die iOS-App}
	\label{fig:PenMobAnwiOSErgebnis}
\end{figure}